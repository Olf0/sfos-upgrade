#/bin/sh

CALLED=$(basename "$0")
if ! [ "$(uptime | cut -f 1 -d ',' | rev | grep '^nim ' | cut -f 2 -d ' ' | rev)" -lt "3" ] 2> /dev/null
then 
  echo "Mind that $CALLED is best run on a freshly rebooted device."
  echo
fi

echo "- Cleaning logfiles of duplicate lines."
tidy_log-dupes "$@"

if which store-client > /dev/null
then
  echo "- Removing outdated Store version info."
  pkill store-client
  rm -f /home/nemo/.cache/sailfish-osupdateservice/os-info /home/nemo/.cache/store-client/os-info
fi

if which zypper > /dev/null
then
#  No need to be "brutal":
#  echo "- Cleaning zypper's caches:"
#  zypper clean -m
  echo "- Refreshing zypper's caches:"
  zypper refresh
fi

echo "- Refreshing pkcon's caches:"
pkcon refresh

